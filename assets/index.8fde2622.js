import{s as e,g as t,l as a,n as l,I as n,B as r,r as i,E as o,D as u,aa as s,i as c,j as d,C as f,M as g,G as v,t as m,m as p,q as b,ax as h,a3 as y,ay as x,az as S,aA as C}from"./index.8b92154c.js";import{a as k,u as w}from"./use-route.ff81261d.js";import{a as V,f as B}from"./useChildren.560f8115.js";var F=a("cell"),M=F[0],z=F[1],A={icon:String,size:String,title:[Number,String],value:[Number,String],label:[Number,String],center:Boolean,isLink:Boolean,required:Boolean,iconPrefix:String,titleStyle:null,titleClass:null,valueClass:null,labelClass:null,arrowDirection:String,border:{type:Boolean,default:!0},clickable:{type:Boolean,default:null}},P=M({props:e({},A,k),setup:function(e,a){var r=a.slots,i=w(),o=function(){if(r.label||l(e.label))return t("div",{class:[z("label"),e.labelClass]},[r.label?r.label():e.label])},u=function(){if(r.title||l(e.title))return t("div",{class:[z("title"),e.titleClass],style:e.titleStyle},[r.title?r.title():t("span",null,[e.title]),o()])},s=function(){var a=r.title||l(e.title);if(r.default||l(e.value))return t("div",{class:[z("value",{alone:!a}),e.valueClass]},[r.default?r.default():t("span",null,[e.value])])},c=function(){if(r["right-icon"])return r["right-icon"]();if(e.isLink){var a=e.arrowDirection?"arrow-"+e.arrowDirection:"arrow";return t(n,{name:a,class:z("right-icon")},null)}};return function(){var a,l=e.size,o=e.center,d=e.border,f=e.isLink,g=e.required,v=null!=(a=e.clickable)?a:f,m={center:o,required:g,clickable:v,borderless:!d};return l&&(m[l]=!!l),t("div",{class:z(m),role:v?"button":void 0,tabindex:v?0:void 0,onClick:i},[r.icon?r.icon():e.icon?t(n,{name:e.icon,class:z("left-icon"),classPrefix:e.iconPrefix},null):void 0,u(),s(),c(),null==r.extra?void 0:r.extra()])}}});function I(e,t){return(!t.required||!function(e){return Array.isArray(e)?!e.length:0!==e&&!e}(e))&&!(t.pattern&&!t.pattern.test(String(e)))}function T(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!b(e)}var j=a("field"),q=j[0],L=j[1],N=q({props:e({},A,{rows:[Number,String],name:String,rules:Array,autosize:[Boolean,Object],leftIcon:String,rightIcon:String,clearable:Boolean,formatter:Function,maxlength:[Number,String],labelWidth:[Number,String],labelClass:null,labelAlign:String,inputAlign:String,placeholder:String,autocomplete:String,errorMessage:String,errorMessageAlign:String,showWordLimit:Boolean,type:{type:String,default:"text"},error:{type:Boolean,default:null},colon:{type:Boolean,default:null},disabled:{type:Boolean,default:null},readonly:{type:Boolean,default:null},modelValue:{type:[String,Number],default:""},clearTrigger:{type:String,default:"focus"},formatTrigger:{type:String,default:"onChange"}}),emits:["blur","focus","clear","keypress","click-input","click-left-icon","click-right-icon","update:modelValue"],setup:function(e,a){var b=a.emit,k=a.slots,w=r({focused:!1,validateFailed:!1,validateMessage:""}),F=i(),M=i(),z=V("vanForm").parent,A=function(t){return l(e[t])?e[t]:z&&l(z.props[t])?z.props[t]:void 0},j=o((function(){var t=A("readonly");if(e.clearable&&!t){var a=l(e.modelValue)&&""!==e.modelValue,n="always"===e.clearTrigger||"focus"===e.clearTrigger&&w.focused;return a&&n}})),q=o((function(){return M.value&&k.input?M.value():e.modelValue})),N=function(e,t){var a=t.message;return C(a)?a(e,t):a},D=function(e){return e.reduce((function(e,t){return e.then((function(){if(!w.validateFailed){var e=q.value;return t.formatter&&(e=t.formatter(e,t)),I(e,t)?t.validator?function(e,t){return new Promise((function(a){var l=t.validator(e,t);if(y(l))return l.then(a);a(l)}))}(e,t).then((function(a){a&&"string"==typeof a?(w.validateFailed=!0,w.validateMessage=a):!1===a&&(w.validateFailed=!0,w.validateMessage=N(e,t))})):void 0:(w.validateFailed=!0,void(w.validateMessage=N(e,t)))}}))}),Promise.resolve())},W=function(){w.validateFailed&&(w.validateFailed=!1,w.validateMessage="")},E=function(t){return void 0===t&&(t=e.rules),new Promise((function(a){t||a(),W(),D(t).then((function(){w.validateFailed?a({name:e.name,message:w.validateMessage}):a()}))}))},O=function(t){if(z&&e.rules){var a=z.props.validateTrigger===t,l=e.rules.filter((function(e){return e.trigger?e.trigger===t:a}));E(l)}},H=function(t,a){void 0===a&&(a="onChange"),t=l(t)?String(t):"";var n=e.maxlength,r=e.modelValue;if(l(n)&&t.length>n&&(t=r&&r.length===+n?r:t.slice(0,n)),"number"===e.type||"digit"===e.type){var i="number"===e.type;t=B(t,i,i)}e.formatter&&a===e.formatTrigger&&(t=e.formatter(t)),F.value&&t!==F.value.value&&(F.value.value=t),t!==e.modelValue&&b("update:modelValue",t)},G=function(e){e.target.composing||H(e.target.value)},K=function(){F.value&&F.value.blur()},J=function(e){w.focused=!0,b("focus",e),A("readonly")&&K()},Q=function(t){w.focused=!1,H(e.modelValue,"onBlur"),b("blur",t),O("onBlur"),x()},R=function(e){b("click-input",e)},U=function(e){b("click-left-icon",e)},X=function(e){b("click-right-icon",e)},Y=function(e){g(e),b("update:modelValue",""),b("clear",e)},Z=o((function(){return"boolean"==typeof e.error?e.error:!!(z&&z.props.showError&&w.validateFailed)||void 0})),$=o((function(){var e=A("labelWidth");if(e)return{width:v(e)}})),_=function(t){13===t.keyCode&&(A("submitOnEnter")||"textarea"===e.type||g(t),"search"===e.type&&K());b("keypress",t)},ee=function(e){e.target.composing=!0},te=function(e){var t=e.target;t.composing&&(t.composing=!1,S(t,"input"))},ae=function(){var t=F.value;if("textarea"===e.type&&e.autosize&&t){t.style.height="auto";var a=t.scrollHeight;if(m(e.autosize)){var l=e.autosize,n=l.maxHeight,r=l.minHeight;n&&(a=Math.min(a,n)),r&&(a=Math.max(a,r))}a&&(t.style.height=a+"px")}},le=function(){var a=A("disabled"),l=A("readonly"),n=A("inputAlign");if(k.input)return t("div",{class:L("control",[n,"custom"]),onClick:R},[k.input()]);var r={ref:F,name:e.name,rows:e.rows,class:L("control",n),value:e.modelValue,disabled:a,readonly:l,placeholder:e.placeholder,autocomplete:e.autocomplete,onBlur:Q,onFocus:J,onInput:G,onClick:R,onChange:te,onKeypress:_,onCompositionend:te,onCompositionstart:ee},i=e.type;if("textarea"===i)return t("textarea",r,null);var o,u=i;return"number"===i&&(u="text",o="decimal"),"digit"===i&&(u="tel",o="numeric"),t("input",p({type:u,inputmode:o},r),null)},ne=function(){var a=k["right-icon"];if(e.rightIcon||a)return t("div",{class:L("right-icon"),onClick:X},[a?a():t(n,{name:e.rightIcon,classPrefix:e.iconPrefix},null)])},re=function(){if(e.showWordLimit&&e.maxlength){var a=(e.modelValue||"").length;return t("div",{class:L("word-limit")},[t("span",{class:L("word-num")},T(a)?a:{default:function(){return[a]}}),h("/"),e.maxlength])}},ie=function(){if(!z||!1!==z.props.showErrorMessage){var a=e.errorMessage||w.validateMessage;if(a){var l=A("errorMessageAlign");return t("div",{class:L("error-message",l)},T(a)?a:{default:function(){return[a]}})}}};return u({blur:K,focus:function(){F.value&&F.value.focus()},validate:E,formValue:q,resetValidation:W}),s("vanField",{childFieldValue:M,resetValidation:W,validateWithTrigger:O}),c((function(){return e.modelValue}),(function(e){H(e),W(),O("onChange"),f(ae)})),d((function(){H(e.modelValue,e.formatTrigger),f(ae)})),function(){var a,l,r=A("disabled"),i=A("labelAlign"),o=(l=A("colon")?":":"",k.label?[k.label(),l]:e.label?t("span",null,[e.label+l]):void 0),u=function(){var a=k["left-icon"];if(e.leftIcon||a)return t("div",{class:L("left-icon"),onClick:U},[a?a():t(n,{name:e.leftIcon,classPrefix:e.iconPrefix},null)])}();return t(P,{size:e.size,icon:e.leftIcon,class:L((a={error:Z.value,disabled:r},a["label-"+i]=i,a["min-height"]="textarea"===e.type&&!e.autosize,a)),center:e.center,border:e.border,isLink:e.isLink,required:e.required,clickable:e.clickable,titleStyle:$.value,valueClass:L("value"),titleClass:[L("label",i),e.labelClass],arrowDirection:e.arrowDirection},{default:function(){return[t("div",{class:L("body")},[le(),j.value&&t(n,{name:"clear",class:L("clear"),onTouchstart:Y},null),ne(),k.button&&t("div",{class:L("button")},[k.button()])]),re(),ie()]},icon:u?function(){return u}:null,title:o?function(){return o}:null,extra:k.extra})}}});export{P as C,N as F};
