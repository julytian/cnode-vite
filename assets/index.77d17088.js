import{a1 as e,a2 as t,au as o,r as n,ai as a,E as l,g as i,l as s,n as r,a8 as u,B as c,D as d,w as p,aq as v,P as f,q as m,av as b,I as h,z as w,d as y,_ as g,b as x,a as k,W as C,Z as O,u as V,aw as P,p as j,c as z,e as I,o as S,f as B,R as W,F as T,h as _}from"./index.8b92154c.js";import{u as M,a as N}from"./useChildren.560f8115.js";import{C as R,F as U}from"./index.8fde2622.js";import{T as D}from"./index.c965e512.js";import"./use-route.ff81261d.js";import"./mount-component.b1cf4679.js";var E=s("dropdown-menu"),q=E[0],A=E[1],F=q({props:{zIndex:[Number,String],activeColor:String,overlay:{type:Boolean,default:!0},duration:{type:[Number,String],default:.2},direction:{type:String,default:"down"},closeOnClickOutside:{type:Boolean,default:!0},closeOnClickOverlay:{type:Boolean,default:!0}},setup:function(s,c){var d=c.slots,p=n(),v=n(0),f=n(),m=M("vanDropdownMenu"),b=m.children,h=m.linkChildren,w=a(p),y=l((function(){return b.some((function(e){return e.state.showWrapper}))})),g=l((function(){if(y.value&&r(s.zIndex))return{zIndex:1+s.zIndex}})),x=function(){if(f.value){var e=u(f);"down"===s.direction?v.value=e.bottom:v.value=window.innerHeight-e.top}},k=function(e,t){var o=e.state.showPopup,n=e.disabled,a=e.titleClass;return i("div",{role:"button",tabindex:n?-1:0,class:A("item",{disabled:n}),onClick:function(){var e;n||(e=t,b.forEach((function(t,o){o===e?(x(),t.toggle()):t.state.showPopup&&t.toggle(!1,{immediate:!0})})))}},[i("span",{class:[A("title",{down:o===("down"===s.direction),active:o}),a],style:{color:o?s.activeColor:""}},[i("div",{class:"van-ellipsis"},[e.renderTitle()])])])};return h({props:s,offset:v}),function(n,a,l){if(void 0===l&&(l={}),e){var i=l.eventName;t(void 0===i?"click":i,(function(e){var t=o(n);t&&!t.contains(e.target)&&a(e)}),{target:document})}}(p,(function(){s.closeOnClickOutside&&b.forEach((function(e){e.toggle(!1)}))})),t("scroll",(function(){y.value&&x()}),{target:w}),function(){return i("div",{ref:p,class:A()},[i("div",{ref:f,style:g.value,class:A("bar",{opened:y.value})},[b.map(k)]),null==d.default?void 0:d.default()])}}});var H=s("dropdown-item"),$=H[0],Z=H[1],G=$({props:{title:String,disabled:Boolean,teleport:[String,Object],modelValue:null,titleClass:null,options:{type:Array,default:function(){return[]}},lazyRender:{type:Boolean,default:!0}},emits:["open","opened","close","closed","change","update:modelValue"],setup:function(e,t){var o=t.emit,n=t.slots,a=c({showPopup:!1,transition:!0,showWrapper:!1}),l=N("vanDropdownMenu").parent,s=function(e){return function(){return o(e)}},r=s("open"),u=s("close"),w=s("opened"),y=function(){a.showWrapper=!1,o("closed")},g=function(t){e.teleport&&t.stopPropagation()},x=function(t){var n=l.props.activeColor,s=t.value===e.modelValue;return i(R,{clickable:!0,key:t.value,icon:t.icon,title:t.text,class:Z("option",{active:s}),style:{color:s?n:""},onClick:function(){a.showPopup=!1,t.value!==e.modelValue&&(o("update:modelValue",t.value),o("change",t.value))}},{default:function(){return[s&&i(h,{class:Z("icon"),color:n,name:"success"},null)]}})},k=function(){var t=l.offset,o=l.props,s=o.zIndex,c=o.overlay,d=o.duration,m=o.direction,b=o.closeOnClickOverlay,h={zIndex:s};return"down"===m?h.top=t.value+"px":h.bottom=t.value+"px",p(i("div",{style:h,class:Z([m]),onClick:g},[i(f,{show:a.showPopup,"onUpdate:show":function(e){return a.showPopup=e},class:Z("content"),overlay:c,position:"down"===m?"top":"bottom",duration:a.transition?d:0,lazyRender:e.lazyRender,overlayStyle:{position:"absolute"},closeOnClickOverlay:b,onOpen:r,onClose:u,onOpened:w,onClosed:y},{default:function(){return[e.options.map(x),null==n.default?void 0:n.default()]}})]),[[v,a.showWrapper]])};return d({state:a,toggle:function(e,t){void 0===e&&(e=!a.showPopup),void 0===t&&(t={}),e!==a.showPopup&&(a.showPopup=e,a.transition=!t.immediate,e&&(a.showWrapper=!0))},renderTitle:function(){if(n.title)return n.title();if(e.title)return e.title;var t=e.options.filter((function(t){return t.value===e.modelValue}));return t.length?t[0].text:""}}),function(){var t,o;return e.teleport?i(b,{to:e.teleport},"function"==typeof(o=t=k())||"[object Object]"===Object.prototype.toString.call(o)&&!m(o)?t:{default:function(){return[t]}}):k()}}});var J=y({name:"AddPage",components:{[F.name]:F,[G.name]:G,[U.name]:U,NavHeader:g},setup(){const e=x(),t=k(),o=n(""),a=l((()=>{var e;return(null==(e=V().params)?void 0:e.id)||""})),i=a.value?"更新":"发布",s=c({tab:"dev",options:[{text:"测试",value:"dev"},{text:"分享",value:"share"},{text:"问答",value:"ask"},{text:"招聘",value:"job"}],title:"",content:""});C((()=>{a.value?(o.value="编辑主题",P(a.value,!1,e.state.user.userInfo.token).then((e=>{s.title=e.title,s.content=e.content,s.tab=e.tab}))):o.value="添加主题"}));return{topic:s,submit:async()=>{if(!s.title)return void D("标题不能为空");if(!s.content)return void D("内容不能为空");const o={accesstoken:e.state.user.userInfo.token,title:s.title,tab:s.tab,content:s.content};try{if(a){o.topic_id=a.value;(await function(e){return w.post("/topics/update",e)}(o)).success&&(D("更新成功"),e.dispatch(`topic/${O}`,{id:a.value}),t.back())}else{(await function(e){return w.post("/topics",e)}(o)).success&&(D("发布成功"),t.replace(`/list?tab=${s.tab}`))}}catch(n){D(a.value?"更新失败":"发布失败")}},title:o,btnText:i}}});const K=_("data-v-9628a178");j("data-v-9628a178");const L={class:"d-flex align-items-center van-hairline--bottom add-hd"},Q=i("span",null,"选择分类：",-1),X={class:"flex-1"},Y={class:"add-title van-hairline--bottom"},ee={class:"add-content"};z();const te=K(((e,t,o,n,a,l)=>{const s=I("nav-header"),r=I("van-dropdown-item"),u=I("van-dropdown-menu"),c=I("van-field");return S(),B(T,null,[i(s,{title:e.title,"show-add":!1},null,8,["title"]),i("div",L,[Q,i("div",X,[i(u,null,{default:K((()=>[i(r,{modelValue:e.topic.tab,"onUpdate:modelValue":t[1]||(t[1]=t=>e.topic.tab=t),options:e.topic.options},null,8,["modelValue","options"])])),_:1})]),i("div",{class:"submit-btn",onClick:t[2]||(t[2]=(...t)=>e.submit&&e.submit(...t))},W(e.btnText),1)]),i("div",Y,[i(c,{modelValue:e.topic.title,"onUpdate:modelValue":t[3]||(t[3]=t=>e.topic.title=t),modelModifiers:{trim:!0},clearable:"",maxlength:"100",placeholder:"标题，字数10字以上"},null,8,["modelValue"])]),i("div",ee,[i(c,{modelValue:e.topic.content,"onUpdate:modelValue":t[4]||(t[4]=t=>e.topic.content=t),rows:"20",type:"textarea",placeholder:"回复支持Markdown语法,请注意标记代码"},null,8,["modelValue"])])],64)}));J.render=te,J.__scopeId="data-v-9628a178";export default J;
