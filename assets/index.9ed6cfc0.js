import{r as o,y as t,E as e,n as a,G as n,i,x as s,H as r,g as l,l as c,w as u,J as d,m as f,I as m,B as p,K as v,s as g,q as h,M as w,L as y,D as b,j as x,C as I,P as S,d as _,N as P,O as T,p as C,c as k,o as N,f as z,Q as j,R as B,h as L,T as X,_ as H,U as R,V as Y,u as Z,b as O,W,X as E,Y as D,Z as $,e as M,$ as A,a0 as q,F}from"./index.33ff7d70.js";import{m as U,u as V}from"./mount-component.39be6864.js";import{S as G,u as J,a as K,c as Q}from"./index.bd75eabf.js";import{r as oo}from"./useChildren.2d928c69.js";var to=c("image"),eo=to[0],ao=to[1],no=eo({props:{src:String,alt:String,fit:String,round:Boolean,width:[Number,String],height:[Number,String],radius:[Number,String],lazyLoad:Boolean,iconPrefix:String,showError:{type:Boolean,default:!0},showLoading:{type:Boolean,default:!0},errorIcon:{type:String,default:"photo-fail"},loadingIcon:{type:String,default:"photo"}},emits:["load","error"],setup:function(c,p){var v=p.emit,g=p.slots,h=o(!1),w=o(!0),y=o(),b=t().proxy.$Lazyload,x=e((function(){var o={};return a(c.width)&&(o.width=n(c.width)),a(c.height)&&(o.height=n(c.height)),a(c.radius)&&(o.overflow="hidden",o.borderRadius=n(c.radius)),o}));i((function(){return c.src}),(function(){h.value=!1,w.value=!0}));var I=function(o){w.value=!1,v("load",o)},S=function(o){h.value=!0,w.value=!1,v("error",o)},_=function(){if(!h.value&&c.src){var o={alt:c.alt,class:ao("img"),style:{objectFit:c.fit}};return c.lazyLoad?u(l("img",f({ref:y},o),null),[[d("lazy"),c.src]]):l("img",f({src:c.src,onLoad:I,onError:S},o),null)}},P=function(o){o.el===y.value&&w.value&&I()},T=function(o){o.el!==y.value||h.value||S()};return b&&s&&(b.$on("loaded",P),b.$on("error",T),r((function(){b.$off("loaded",P),b.$off("error",T)}))),function(){return l("div",{class:ao({round:c.round}),style:x.value},[_(),w.value&&c.showLoading?l("div",{class:ao("loading")},[g.loading?g.loading():l(m,{name:c.loadingIcon,class:ao("loading-icon"),classPrefix:c.iconPrefix},null)]):h.value&&c.showError?l("div",{class:ao("error")},[g.error?g.error():l(m,{name:c.errorIcon,class:ao("error-icon"),classPrefix:c.iconPrefix},null)]):void 0,null==g.default?void 0:g.default()])}}}),io=c("image-preview"),so=io[0],ro=io[1];function lo(o){return Math.sqrt(Math.pow(o[0].clientX-o[1].clientX,2)+Math.pow(o[0].clientY-o[1].clientY,2))}var co={props:{src:String,show:Boolean,active:Number,minZoom:[Number,String],maxZoom:[Number,String],rootWidth:Number,rootHeight:Number},emits:["scale","close"],setup:function(o,t){var a,n,s,r,c,u,d=t.emit,f=p({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,imageRatio:0,displayWidth:0,displayHeight:0}),m=v(),b=e((function(){var t=o.rootWidth,e=o.rootHeight/t;return f.imageRatio>e})),x=e((function(){var o=f.scale,t=f.moveX,e=f.moveY,a=f.moving,n={transitionDuration:f.zooming||a?"0s":".3s"};if(1!==o){var i=t/o,s=e/o;n.transform="scale("+o+", "+o+") translate("+i+"px, "+s+"px)"}return n})),I=e((function(){if(f.imageRatio){var t=o.rootWidth,e=o.rootHeight,a=b.value?e/f.imageRatio:t;return Math.max(0,(f.scale*a-t)/2)}return 0})),S=e((function(){if(f.imageRatio){var t=o.rootWidth,e=o.rootHeight,a=b.value?e:t*f.imageRatio;return Math.max(0,(f.scale*a-e)/2)}return 0})),_=function(t){(t=oo(t,+o.minZoom,+o.maxZoom))!==f.scale&&(f.scale=t,d("scale",{scale:t,index:o.active}))},P=function(){_(1),f.moveX=0,f.moveY=0},T=function(o){var t=o.touches,e=m.offsetX;m.start(o),a=f.moveX,n=f.moveY,u=new Date,f.moving=1===t.length&&1!==f.scale,f.zooming=2===t.length&&!e.value,f.zooming&&(s=f.scale,r=lo(o.touches))},C=function(o){var t=o.touches;if(m.move(o),(f.moving||f.zooming)&&w(o,!0),f.moving){var e=m.deltaX,i=m.deltaY,l=e.value+a,c=i.value+n;f.moveX=oo(l,-I.value,I.value),f.moveY=oo(c,-S.value,S.value)}if(f.zooming&&2===t.length){var u=lo(t);_(s*u/r)}},k=function(){var o,t=m.offsetX,e=m.offsetY,a=new Date-u;t.value<10&&e.value<10&&a<250&&(c?(clearTimeout(c),c=null,o=f.scale>1?1:2,_(o),f.moveX=0,f.moveY=0):c=setTimeout((function(){d("close"),c=null}),250))},N=function(o){var t=!1;(f.moving||f.zooming)&&(t=!0,f.moving&&a===f.moveX&&n===f.moveY&&(t=!1),o.touches.length||(f.zooming&&(f.moveX=oo(f.moveX,-I.value,I.value),f.moveY=oo(f.moveY,-S.value,S.value),f.zooming=!1),f.moving=!1,a=0,n=0,s=1,f.scale<1&&P())),w(o,t),k(),m.reset()},z=function(o){var t=o.target,e=t.naturalWidth,a=t.naturalHeight;f.imageRatio=a/e};return i((function(){return o.active}),P),i((function(){return o.show}),(function(o){o||P()})),function(){var t,e,a={loading:function(){return l(y,{type:"spinner"},null)}};return l(G,{class:ro("swipe-item"),onTouchstart:T,onTouchmove:C,onTouchend:N,onTouchcancel:N},"function"==typeof(e=t=l(no,{src:o.src,fit:"contain",class:ro("image",{vertical:b.value}),style:x.value,onLoad:z},g({},a)))||"[object Object]"===Object.prototype.toString.call(e)&&!h(e)?t:{default:function(){return[t]}})}}};var uo,fo=so({props:{show:Boolean,className:null,closeable:Boolean,beforeClose:Function,showIndicators:Boolean,images:{type:Array,default:function(){return[]}},loop:{type:Boolean,default:!0},overlay:{type:Boolean,default:!0},minZoom:{type:[Number,String],default:1/3},maxZoom:{type:[Number,String],default:3},showIndex:{type:Boolean,default:!0},swipeDuration:{type:[Number,String],default:300},startPosition:{type:[Number,String],default:0},closeIcon:{type:String,default:"clear"},closeOnPopstate:{type:Boolean,default:!0},closeIconPosition:{type:String,default:"top-right"}},emits:["scale","close","closed","change","update:show"],setup:function(t,e){var a=e.emit,n=e.slots,s=o(),r=J(),c=p({active:0,rootWidth:0,rootHeight:0}),u=function(){if(s.value){var o=s.value.$el.getBoundingClientRect();c.rootWidth=o.width,c.rootHeight=o.height}},d=function(o){a("scale",o)},v=function(o){a("update:show",o)},g=function(){Q({interceptor:t.beforeClose,args:[c.active],done:function(){v(!1)}})},w=function(o){o!==c.active&&(c.active=o,a("change",o))},y=function(){if(t.showIndex)return l("div",{class:ro("index")},[n.index?n.index({index:c.active}):c.active+1+" / "+t.images.length])},_=function(){if(n.cover)return l("div",{class:ro("cover")},[n.cover()])},P=function(){var o,e;return l(K,{ref:s,lazyRender:!0,loop:t.loop,class:ro("swipe"),duration:t.swipeDuration,initialSwipe:t.startPosition,showIndicators:t.showIndicators,indicatorColor:"white",onChange:w},"function"==typeof(e=o=t.images.map((function(o){return l(co,{src:o,show:t.show,active:c.active,maxZoom:t.maxZoom,minZoom:t.minZoom,rootWidth:c.rootWidth,rootHeight:c.rootHeight,onScale:d,onClose:g},null)})))||"[object Object]"===Object.prototype.toString.call(e)&&!h(e)?o:{default:function(){return[o]}})},T=function(){if(t.closeable)return l(m,{role:"button",name:t.closeIcon,class:ro("close-icon",t.closeIconPosition),onClick:g},null)},C=function(){a("closed")},k=function(o,t){s.value&&s.value.swipeTo(o,t)};return b({swipeTo:k}),x(u),i([r.width,r.height],u),i((function(){return t.startPosition}),w),i((function(){return t.show}),(function(o){var e=t.images,n=t.startPosition;o?(w(+n),I((function(){u(),k(+n,{immediate:!0})}))):a("close",{index:c.active,url:e[c.active]})})),function(){return l(S,f({show:t.show,class:[ro(),t.className],overlayClass:ro("overlay"),closeOnPopstate:t.closeOnPopstate,onClosed:C},{"onUpdate:show":v}),{default:function(){return[T(),P(),y(),_()]}})}}}),mo={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:null,onClose:null,onChange:null,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",beforeClose:null,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeIconPosition:"top-right"};var po=function(o,t){if(void 0===t&&(t=0),s){var e;uo||(e=U({setup:function(){var o=V(),t=o.state,e=o.toggle,a=function(){t.images=[]};return function(){return l(fo,g({},t,{onClosed:a,"onUpdate:show":e}),null)}}}),uo=e.instance);var a=Array.isArray(o)?{images:o,startPosition:t}:o;return uo.open(g({},mo,a)),uo}};po.Component=fo,po.install=function(o){o.use(fo)};var vo=_({name:"TopicInfo",props:{topic:{type:Object,default:{},required:!0}},methods:{getTabInfo:(o,t,e,a)=>P(o,t,e,a),getLastTimeStr:(o,t)=>T(o,t)}});const go=L("data-v-71559378");C("data-v-71559378");const ho={class:"d-flex align-items-center topic-info"},wo={key:0,class:"topic-info-avatar"},yo={class:"flex-1"},bo={key:0},xo={class:"topic-info-wrap"},Io={class:"topic-info-name"};k();const So=go(((o,t,e,a,n,i)=>{const s=d("lazy");return N(),z("section",ho,[o.topic.author?u((N(),z("img",wo,null,512)),[[s,o.topic.author.avatar_url]]):j("",!0),l("div",yo,[o.topic.author?(N(),z("span",bo,B(o.topic.author.loginname),1)):j("",!0),l("time",null," 发布于："+B(o.getLastTimeStr(o.topic.create_at,!0)),1)]),l("div",xo,[l("span",{class:["topic-info-tag",o.getTabInfo(o.topic.tab,o.topic.good,o.topic.top,!0)],textContent:B(o.getTabInfo(o.topic.tab,o.topic.good,o.topic.top,!1))},null,10,["textContent"]),l("span",Io,B(o.topic.visit_count)+"次浏览",1)])])}));vo.render=So,vo.__scopeId="data-v-71559378";var _o=_({name:"TopicPage",components:{[X.name]:X,[m.name]:m,NavHeader:H,TopicInfo:vo,TopicReply:R((()=>Y((()=>__import__("./topic-reply.13d2fc93.js")),["/assets/topic-reply.13d2fc93.js","/assets/topic-reply.3d12d5ac.css","/assets/index.33ff7d70.js","/assets/index.cf2967e3.css","/assets/index.204e4b03.js","/assets/mount-component.39be6864.js","/assets/index.a0be4774.js","/assets/use-route.6b531580.js","/assets/useChildren.2d928c69.js"]))),BackTop:R((()=>Y((()=>__import__("./back-top.95725df5.js")),["/assets/back-top.95725df5.js","/assets/back-top.d710be5d.css","/assets/index.33ff7d70.js","/assets/index.cf2967e3.css"])))},setup(){const o=Z(),t=O(),a=e((()=>t.state.topic.topic)),n=e((()=>t.state.user.userInfo.token));W((async()=>{const e=o.params.id;a.value.id&&a.value.id===e||await t.dispatch(`topic/${$}`,e),I((()=>{const o=document.querySelectorAll(".markdown-body img"),t=[];o.forEach(((o,e)=>{let a=o.getAttribute("src");a.startsWith("http")||(a=`https:${a}`),t.push(a),o.addEventListener("click",(()=>{po({images:t,startPosition:e,closeable:!0,teleport:"body"})}))}))}))}));return{topic:a,token:n,toggleCollect:async t=>{const e=o.params.id;if(t){(await E(n.value,e)).success&&(a.value.is_collect=!1)}else{(await D(n.value,e)).success&&(a.value.is_collect=!0)}}}}});const Po=L("data-v-7d4cfe49");C("data-v-7d4cfe49");const To={class:"topic-title"};k();const Co=Po(((o,t,e,a,n,i)=>{const s=M("van-icon"),r=M("nav-header"),c=M("topic-info"),u=M("van-skeleton"),d=M("topic-reply"),f=M("back-top");return N(),z(F,null,[l(r,{title:"主题"},A({_:2},[o.token?{name:"collect",fn:Po((()=>[l(s,{name:"like",size:"20",color:o.topic.is_collect?"#80bd01":"#000000",onClick:t[1]||(t[1]=t=>o.toggleCollect(o.topic.is_collect))},null,8,["color"])]))}:void 0]),1024),l("h2",To,B(o.topic.title),1),l(u,{title:"",avatar:"",row:5,loading:!o.topic.id,class:"skeleton-top"},{default:Po((()=>[l(c,{topic:o.topic},null,8,["topic"]),l("section",{class:"markdown-body topic-content van-hairline--bottom",innerHTML:o.topic.content},null,8,["innerHTML"])])),_:1},8,["loading"]),(N(),z(q,null,{default:Po((()=>[l(d,{topic:o.topic},null,8,["topic"])])),fallback:Po((()=>[l(u,{title:"",row:5,class:"skeleton-top"})])),_:1})),l(f)],64)}));_o.render=Co,_o.__scopeId="data-v-7d4cfe49";export default _o;
