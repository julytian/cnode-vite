import{r as e,a1 as t,a2 as a,a3 as i,a4 as n,B as u,K as o,E as r,D as l,i as c,j as v,W as s,a5 as f,H as d,g as h,l as p,a6 as g,a7 as w,a8 as m,M as y,C as b}from"./index.33ff7d70.js";import{u as S,r as C,a as x}from"./useChildren.2d928c69.js";function z(){var i=e(t?window.innerWidth:0),n=e(t?window.innerHeight:0),u=function(){i.value=window.innerWidth,n.value=window.innerHeight};return a("resize",u),a("orientationchange",u),{width:i,height:n}}function M(e){var t=e.interceptor,a=e.args,u=e.done,o=e.canceled;if(t){var r=t.apply(null,a||[]);i(r)?r.then((function(e){e?u():o&&o()})).catch(n):r?u():o&&o()}else u()}var B=p("swipe"),T=B[0],N=B[1],D=T({props:{width:[Number,String],height:[Number,String],autoplay:[Number,String],vertical:Boolean,lazyRender:Boolean,indicatorColor:String,loop:{type:Boolean,default:!0},duration:{type:[Number,String],default:500},touchable:{type:Boolean,default:!0},initialSwipe:{type:[Number,String],default:0},showIndicators:{type:Boolean,default:!0},stopPropagation:{type:Boolean,default:!0}},emits:["change"],setup:function(i,n){var p,b,x,M,B=n.emit,T=n.slots,D=e(),I=u({rect:null,width:0,height:0,offset:0,active:0,swiping:!1}),O=o(),X=z(),Y=S("vanSwipe"),j=Y.children,k=Y.linkChildren,H=r((function(){return j.length})),W=r((function(){return I[i.vertical?"height":"width"]})),A=r((function(){return i.vertical?O.deltaY.value:O.deltaX.value})),E=r((function(){return(i.vertical?I.rect.height:I.rect.width)-W.value*H.value})),P=r((function(){return Math.ceil(Math.abs(E.value)/W.value)})),R=r((function(){return H.value*W.value})),K=r((function(){return(I.active+H.value)%H.value})),q=r((function(){var e=i.vertical?"vertical":"horizontal";return O.direction.value===e})),F=r((function(){var e=i.vertical?"height":"width",t=i.vertical?"width":"height",a={transitionDuration:(I.swiping?0:i.duration)+"ms",transform:"translate"+(i.vertical?"Y":"X")+"("+I.offset+"px)"};return W.value&&(a[e]=R.value+"px",a[t]=i[t]?i[t]+"px":""),a})),G=function(e,t){void 0===t&&(t=0);var a=e*W.value;i.loop||(a=Math.min(a,-E.value));var n=t-a;return i.loop||(n=C(n,E.value,0)),n},J=function(e){var t=e.pace,a=void 0===t?0:t,n=e.offset,u=void 0===n?0:n,o=e.emitChange;if(!(H.value<=1)){var r=I.active,l=function(e){var t=I.active;return e?i.loop?C(t+e,-1,H.value):C(t+e,0,P.value):t}(a),c=G(l,u);if(i.loop){if(j[0]&&c!==E.value){var v=c<E.value;j[0].setOffset(v?R.value:0)}if(j[H.value-1]&&0!==c){var s=c>0;j[H.value-1].setOffset(s?-R.value:0)}}I.active=l,I.offset=c,o&&l!==r&&B("change",K.value)}},L=function(){I.swiping=!0,I.active<=-1&&J({pace:H.value}),I.active>=H.value&&J({pace:-H.value})},Q=function(){L(),O.reset(),g((function(){I.swiping=!1,J({pace:1,emitChange:!0})}))},U=function(){clearTimeout(p)},V=function e(){i.autoplay>0&&H.value>1&&(U(),p=setTimeout((function(){Q(),e()}),i.autoplay))},Z=function(e){if(void 0===e&&(e=+i.initialSwipe),D.value&&!w(D)){U();var t=m(D);I.rect=t,I.swiping=!0,I.active=e,I.width=+i.width||t.width,I.height=+i.height||t.height,I.offset=G(e),j.forEach((function(e){e.setOffset(0)})),V()}},$=function(){Z(I.active)},_=function(e){i.touchable&&(O.start(e),b=Date.now(),U(),L())},ee=function(e){i.touchable&&I.swiping&&(O.move(e),q.value&&(y(e,i.stopPropagation),J({offset:A.value})))},te=function(){if(i.touchable&&I.swiping){var e=Date.now()-b,t=A.value/e;if((Math.abs(t)>.25||Math.abs(A.value)>W.value/2)&&q.value){var a=i.vertical?O.offsetY.value:O.offsetX.value,n=0;n=i.loop?a>0?A.value>0?-1:1:0:-Math[A.value>0?"ceil":"floor"](A.value/W.value),J({pace:n,emitChange:!0})}else A.value&&J({pace:0});I.swiping=!1,V()}},ae=function(e,t){var a=t===K.value,n=a?{backgroundColor:i.indicatorColor}:null;return h("i",{style:n,class:N("indicator",{active:a})},null)};return l({prev:function(){L(),O.reset(),g((function(){I.swiping=!1,J({pace:-1,emitChange:!0})}))},next:Q,state:I,resize:$,swipeTo:function(e,t){void 0===t&&(t={}),L(),O.reset(),g((function(){var a;a=i.loop&&e===H.value?0===I.active?0:e:e%H.value,t.immediate?g((function(){I.swiping=!1})):I.swiping=!1,J({pace:a-I.active,emitChange:!0})}))}}),k({size:W,props:i,count:H,activeIndicator:K}),c((function(){return i.initialSwipe}),Z),c((function(){return j.length}),(function(){var e=Math.min(j.length-1,I.active);Z(e)})),c((function(){return i.autoplay}),(function(e){e>0?V():U()})),c([X.width,X.height],$),c((x=e("visible"),(M=function(){t&&(x.value=document.hidden?"hidden":"visible")})(),a("visibilitychange",M),x),(function(e){"visible"===e?V():U()})),v(Z),s((function(){Z(I.active)})),f(U),d(U),function(){return h("div",{ref:D,class:N()},[h("div",{style:F.value,class:N("track",{vertical:i.vertical}),onTouchstart:_,onTouchmove:ee,onTouchend:te,onTouchcancel:te},[null==T.default?void 0:T.default()]),T.indicator?T.indicator():i.showIndicators&&H.value>1?h("div",{class:N("indicators",{vertical:i.vertical})},[Array.apply(void 0,Array(H.value)).map(ae)]):void 0])}}}),I=p("swipe-item"),O=I[0],X=I[1],Y=O({setup:function(e,t){var a,i=t.slots,n=u({offset:0,inited:!1,mounted:!1}),o=x("vanSwipe"),c=o.parent,s=o.index,f=r((function(){var e={},t=c.props.vertical;return c.size.value&&(e[t?"height":"width"]=c.size.value+"px"),n.offset&&(e.transform="translate"+(t?"Y":"X")+"("+n.offset+"px)"),e})),d=r((function(){var e=c.props,t=e.loop;if(!e.lazyRender||a)return!0;if(!n.mounted)return!1;var i=c.activeIndicator.value,u=c.count.value-1,o=0===i&&t?u:i-1,r=i===u&&t?0:i+1;return a=s.value===i||s.value===o||s.value===r}));return v((function(){b((function(){n.mounted=!0}))})),l({setOffset:function(e){n.offset=e}}),function(){return h("div",{class:X(),style:f.value},[d.value?null==i.default?void 0:i.default():null])}}});export{Y as S,D as a,M as c,z as u};
