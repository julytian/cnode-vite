import{r as o,y as t,E as e,n as a,G as n,i,x as r,H as s,g as l,l as c,w as u,J as d,m,I as f,B as p,K as v,s as g,q as h,M as w,L as y,D as b,j as x,C as I,P as S,d as P,N as T,O as _,p as C,c as N,o as j,f as z,Q as B,R as L,h as X,T as H,_ as R,U as k,V as Y,u as O,b as Z,W,e as E,X as D,F as M}from"./index.40eb45fc.js";import{m as A,u as $}from"./mount-component.617105fe.js";import{S as q,u as F,a as U,c as V}from"./index.e756eb57.js";import{r as G}from"./useChildren.0cc2a4ba.js";var J=c("image"),K=J[0],Q=J[1],oo=K({props:{src:String,alt:String,fit:String,round:Boolean,width:[Number,String],height:[Number,String],radius:[Number,String],lazyLoad:Boolean,iconPrefix:String,showError:{type:Boolean,default:!0},showLoading:{type:Boolean,default:!0},errorIcon:{type:String,default:"photo-fail"},loadingIcon:{type:String,default:"photo"}},emits:["load","error"],setup:function(c,p){var v=p.emit,g=p.slots,h=o(!1),w=o(!0),y=o(),b=t().proxy.$Lazyload,x=e((function(){var o={};return a(c.width)&&(o.width=n(c.width)),a(c.height)&&(o.height=n(c.height)),a(c.radius)&&(o.overflow="hidden",o.borderRadius=n(c.radius)),o}));i((function(){return c.src}),(function(){h.value=!1,w.value=!0}));var I=function(o){w.value=!1,v("load",o)},S=function(o){h.value=!0,w.value=!1,v("error",o)},P=function(){if(!h.value&&c.src){var o={alt:c.alt,class:Q("img"),style:{objectFit:c.fit}};return c.lazyLoad?u(l("img",m({ref:y},o),null),[[d("lazy"),c.src]]):l("img",m({src:c.src,onLoad:I,onError:S},o),null)}},T=function(o){o.el===y.value&&w.value&&I()},_=function(o){o.el!==y.value||h.value||S()};return b&&r&&(b.$on("loaded",T),b.$on("error",_),s((function(){b.$off("loaded",T),b.$off("error",_)}))),function(){return l("div",{class:Q({round:c.round}),style:x.value},[P(),w.value&&c.showLoading?l("div",{class:Q("loading")},[g.loading?g.loading():l(f,{name:c.loadingIcon,class:Q("loading-icon"),classPrefix:c.iconPrefix},null)]):h.value&&c.showError?l("div",{class:Q("error")},[g.error?g.error():l(f,{name:c.errorIcon,class:Q("error-icon"),classPrefix:c.iconPrefix},null)]):void 0,null==g.default?void 0:g.default()])}}}),to=c("image-preview"),eo=to[0],ao=to[1];function no(o){return Math.sqrt(Math.pow(o[0].clientX-o[1].clientX,2)+Math.pow(o[0].clientY-o[1].clientY,2))}var io={props:{src:String,show:Boolean,active:Number,minZoom:[Number,String],maxZoom:[Number,String],rootWidth:Number,rootHeight:Number},emits:["scale","close"],setup:function(o,t){var a,n,r,s,c,u,d=t.emit,m=p({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,imageRatio:0,displayWidth:0,displayHeight:0}),f=v(),b=e((function(){var t=o.rootWidth,e=o.rootHeight/t;return m.imageRatio>e})),x=e((function(){var o=m.scale,t=m.moveX,e=m.moveY,a=m.moving,n={transitionDuration:m.zooming||a?"0s":".3s"};if(1!==o){var i=t/o,r=e/o;n.transform="scale("+o+", "+o+") translate("+i+"px, "+r+"px)"}return n})),I=e((function(){if(m.imageRatio){var t=o.rootWidth,e=o.rootHeight,a=b.value?e/m.imageRatio:t;return Math.max(0,(m.scale*a-t)/2)}return 0})),S=e((function(){if(m.imageRatio){var t=o.rootWidth,e=o.rootHeight,a=b.value?e:t*m.imageRatio;return Math.max(0,(m.scale*a-e)/2)}return 0})),P=function(t){(t=G(t,+o.minZoom,+o.maxZoom))!==m.scale&&(m.scale=t,d("scale",{scale:t,index:o.active}))},T=function(){P(1),m.moveX=0,m.moveY=0},_=function(o){var t=o.touches,e=f.offsetX;f.start(o),a=m.moveX,n=m.moveY,u=new Date,m.moving=1===t.length&&1!==m.scale,m.zooming=2===t.length&&!e.value,m.zooming&&(r=m.scale,s=no(o.touches))},C=function(o){var t=o.touches;if(f.move(o),(m.moving||m.zooming)&&w(o,!0),m.moving){var e=f.deltaX,i=f.deltaY,l=e.value+a,c=i.value+n;m.moveX=G(l,-I.value,I.value),m.moveY=G(c,-S.value,S.value)}if(m.zooming&&2===t.length){var u=no(t);P(r*u/s)}},N=function(){var o,t=f.offsetX,e=f.offsetY,a=new Date-u;t.value<10&&e.value<10&&a<250&&(c?(clearTimeout(c),c=null,o=m.scale>1?1:2,P(o),m.moveX=0,m.moveY=0):c=setTimeout((function(){d("close"),c=null}),250))},j=function(o){var t=!1;(m.moving||m.zooming)&&(t=!0,m.moving&&a===m.moveX&&n===m.moveY&&(t=!1),o.touches.length||(m.zooming&&(m.moveX=G(m.moveX,-I.value,I.value),m.moveY=G(m.moveY,-S.value,S.value),m.zooming=!1),m.moving=!1,a=0,n=0,r=1,m.scale<1&&T())),w(o,t),N(),f.reset()},z=function(o){var t=o.target,e=t.naturalWidth,a=t.naturalHeight;m.imageRatio=a/e};return i((function(){return o.active}),T),i((function(){return o.show}),(function(o){o||T()})),function(){var t,e,a={loading:function(){return l(y,{type:"spinner"},null)}};return l(q,{class:ao("swipe-item"),onTouchstart:_,onTouchmove:C,onTouchend:j,onTouchcancel:j},"function"==typeof(e=t=l(oo,{src:o.src,fit:"contain",class:ao("image",{vertical:b.value}),style:x.value,onLoad:z},g({},a)))||"[object Object]"===Object.prototype.toString.call(e)&&!h(e)?t:{default:function(){return[t]}})}}};var ro,so=eo({props:{show:Boolean,className:null,closeable:Boolean,beforeClose:Function,showIndicators:Boolean,images:{type:Array,default:function(){return[]}},loop:{type:Boolean,default:!0},overlay:{type:Boolean,default:!0},minZoom:{type:[Number,String],default:1/3},maxZoom:{type:[Number,String],default:3},showIndex:{type:Boolean,default:!0},swipeDuration:{type:[Number,String],default:300},startPosition:{type:[Number,String],default:0},closeIcon:{type:String,default:"clear"},closeOnPopstate:{type:Boolean,default:!0},closeIconPosition:{type:String,default:"top-right"}},emits:["scale","close","closed","change","update:show"],setup:function(t,e){var a=e.emit,n=e.slots,r=o(),s=F(),c=p({active:0,rootWidth:0,rootHeight:0}),u=function(){if(r.value){var o=r.value.$el.getBoundingClientRect();c.rootWidth=o.width,c.rootHeight=o.height}},d=function(o){a("scale",o)},v=function(o){a("update:show",o)},g=function(){V({interceptor:t.beforeClose,args:[c.active],done:function(){v(!1)}})},w=function(o){o!==c.active&&(c.active=o,a("change",o))},y=function(){if(t.showIndex)return l("div",{class:ao("index")},[n.index?n.index({index:c.active}):c.active+1+" / "+t.images.length])},P=function(){if(n.cover)return l("div",{class:ao("cover")},[n.cover()])},T=function(){var o,e;return l(U,{ref:r,lazyRender:!0,loop:t.loop,class:ao("swipe"),duration:t.swipeDuration,initialSwipe:t.startPosition,showIndicators:t.showIndicators,indicatorColor:"white",onChange:w},"function"==typeof(e=o=t.images.map((function(o){return l(io,{src:o,show:t.show,active:c.active,maxZoom:t.maxZoom,minZoom:t.minZoom,rootWidth:c.rootWidth,rootHeight:c.rootHeight,onScale:d,onClose:g},null)})))||"[object Object]"===Object.prototype.toString.call(e)&&!h(e)?o:{default:function(){return[o]}})},_=function(){if(t.closeable)return l(f,{role:"button",name:t.closeIcon,class:ao("close-icon",t.closeIconPosition),onClick:g},null)},C=function(){a("closed")},N=function(o,t){r.value&&r.value.swipeTo(o,t)};return b({swipeTo:N}),x(u),i([s.width,s.height],u),i((function(){return t.startPosition}),w),i((function(){return t.show}),(function(o){var e=t.images,n=t.startPosition;o?(w(+n),I((function(){u(),N(+n,{immediate:!0})}))):a("close",{index:c.active,url:e[c.active]})})),function(){return l(S,m({show:t.show,class:[ao(),t.className],overlayClass:ao("overlay"),closeOnPopstate:t.closeOnPopstate,onClosed:C},{"onUpdate:show":v}),{default:function(){return[_(),T(),y(),P()]}})}}}),lo={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:null,onClose:null,onChange:null,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",beforeClose:null,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeIconPosition:"top-right"};var co=function(o,t){if(void 0===t&&(t=0),r){var e;ro||(e=A({setup:function(){var o=$(),t=o.state,e=o.toggle,a=function(){t.images=[]};return function(){return l(so,g({},t,{onClosed:a,"onUpdate:show":e}),null)}}}),ro=e.instance);var a=Array.isArray(o)?{images:o,startPosition:t}:o;return ro.open(g({},lo,a)),ro}};co.Component=so,co.install=function(o){o.use(so)};var uo=P({name:"TopicInfo",props:{topic:{type:Object,default:{},required:!0}},methods:{getTabInfo:(o,t,e,a)=>T(o,t,e,a),getLastTimeStr:(o,t)=>_(o,t)}});const mo=X("data-v-71559378");C("data-v-71559378");const fo={class:"d-flex align-items-center topic-info"},po={key:0,class:"topic-info-avatar"},vo={class:"flex-1"},go={key:0},ho={class:"topic-info-wrap"},wo={class:"topic-info-name"};N();const yo=mo(((o,t,e,a,n,i)=>{const r=d("lazy");return j(),z("section",fo,[o.topic.author?u((j(),z("img",po,null,512)),[[r,o.topic.author.avatar_url]]):B("",!0),l("div",vo,[o.topic.author?(j(),z("span",go,L(o.topic.author.loginname),1)):B("",!0),l("time",null," 发布于："+L(o.getLastTimeStr(o.topic.create_at,!0)),1)]),l("div",ho,[l("span",{class:["topic-info-tag",o.getTabInfo(o.topic.tab,o.topic.good,o.topic.top,!0)],textContent:L(o.getTabInfo(o.topic.tab,o.topic.good,o.topic.top,!1))},null,10,["textContent"]),l("span",wo,L(o.topic.visit_count)+"次浏览",1)])])}));uo.render=yo,uo.__scopeId="data-v-71559378";var bo=P({name:"TopicPage",components:{[H.name]:H,NavHeader:R,TopicInfo:uo,TopicReply:k((()=>Y((()=>__import__("./topic-reply.f2c6cea4.js")),["/cnode-vite/assets/topic-reply.f2c6cea4.js","/cnode-vite/assets/topic-reply.6ebe3c97.css","/cnode-vite/assets/index.40eb45fc.js","/cnode-vite/assets/index.639fd466.css"]))),BackTop:k((()=>Y((()=>__import__("./back-top.22147c34.js")),["/cnode-vite/assets/back-top.22147c34.js","/cnode-vite/assets/back-top.d710be5d.css","/cnode-vite/assets/index.40eb45fc.js","/cnode-vite/assets/index.639fd466.css"])))},setup(){const o=O(),t=Z(),a=e((()=>t.state.topic.topic));return x((async()=>{var e;a.value.id||await t.dispatch(`topic/${W}`,null==(e=o.params)?void 0:e.id),I((()=>{const o=document.querySelectorAll(".markdown-body img"),t=[];o.forEach(((o,e)=>{t.push(o.getAttribute("src")),o.addEventListener("click",(()=>{co({images:t,startPosition:e})}))}))}))})),{topic:a}}});const xo=X("data-v-c0ae527c");C("data-v-c0ae527c");const Io={class:"topic-title"};N();const So=xo(((o,t,e,a,n,i)=>{const r=E("nav-header"),s=E("topic-info"),c=E("van-skeleton"),u=E("topic-reply"),d=E("back-top");return j(),z(M,null,[l(r,{title:"主题"}),l("h2",Io,L(o.topic.title),1),l(c,{title:"",avatar:"",row:5,loading:!o.topic.id,class:"skeleton-top"},{default:xo((()=>[l(s,{topic:o.topic},null,8,["topic"]),l("section",{class:"markdown-body topic-content van-hairline--bottom",innerHTML:o.topic.content},null,8,["innerHTML"])])),_:1},8,["loading"]),(j(),z(D,null,{default:xo((()=>[l(u,{topic:o.topic},null,8,["topic"])])),fallback:xo((()=>[l(c,{title:"",row:5,class:"skeleton-top"})])),_:1})),l(d)],64)}));bo.render=So,bo.__scopeId="data-v-c0ae527c";export default bo;
