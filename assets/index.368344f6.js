import{r as o,y as t,E as e,n as a,G as n,i,x as r,H as s,g as l,l as c,w as u,J as d,m,I as p,B as f,K as v,s as g,q as h,M as w,L as y,D as b,j as x,C as I,P as S,d as P,N as T,O as _,p as C,c as N,o as j,f as z,Q as B,R as L,h as X,T as H,_ as R,U as Y,V as k,u as O,b as W,W as Z,X as E,e as D,Y as M,F as $}from"./index.f8c1ba6c.js";import{m as A,u as q}from"./mount-component.703d2a00.js";import{S as F,u as U,a as V,c as G}from"./index.2eef357d.js";import{r as J}from"./useChildren.747839d4.js";var K=c("image"),Q=K[0],oo=K[1],to=Q({props:{src:String,alt:String,fit:String,round:Boolean,width:[Number,String],height:[Number,String],radius:[Number,String],lazyLoad:Boolean,iconPrefix:String,showError:{type:Boolean,default:!0},showLoading:{type:Boolean,default:!0},errorIcon:{type:String,default:"photo-fail"},loadingIcon:{type:String,default:"photo"}},emits:["load","error"],setup:function(c,f){var v=f.emit,g=f.slots,h=o(!1),w=o(!0),y=o(),b=t().proxy.$Lazyload,x=e((function(){var o={};return a(c.width)&&(o.width=n(c.width)),a(c.height)&&(o.height=n(c.height)),a(c.radius)&&(o.overflow="hidden",o.borderRadius=n(c.radius)),o}));i((function(){return c.src}),(function(){h.value=!1,w.value=!0}));var I=function(o){w.value=!1,v("load",o)},S=function(o){h.value=!0,w.value=!1,v("error",o)},P=function(){if(!h.value&&c.src){var o={alt:c.alt,class:oo("img"),style:{objectFit:c.fit}};return c.lazyLoad?u(l("img",m({ref:y},o),null),[[d("lazy"),c.src]]):l("img",m({src:c.src,onLoad:I,onError:S},o),null)}},T=function(o){o.el===y.value&&w.value&&I()},_=function(o){o.el!==y.value||h.value||S()};return b&&r&&(b.$on("loaded",T),b.$on("error",_),s((function(){b.$off("loaded",T),b.$off("error",_)}))),function(){return l("div",{class:oo({round:c.round}),style:x.value},[P(),w.value&&c.showLoading?l("div",{class:oo("loading")},[g.loading?g.loading():l(p,{name:c.loadingIcon,class:oo("loading-icon"),classPrefix:c.iconPrefix},null)]):h.value&&c.showError?l("div",{class:oo("error")},[g.error?g.error():l(p,{name:c.errorIcon,class:oo("error-icon"),classPrefix:c.iconPrefix},null)]):void 0,null==g.default?void 0:g.default()])}}}),eo=c("image-preview"),ao=eo[0],no=eo[1];function io(o){return Math.sqrt(Math.pow(o[0].clientX-o[1].clientX,2)+Math.pow(o[0].clientY-o[1].clientY,2))}var ro={props:{src:String,show:Boolean,active:Number,minZoom:[Number,String],maxZoom:[Number,String],rootWidth:Number,rootHeight:Number},emits:["scale","close"],setup:function(o,t){var a,n,r,s,c,u,d=t.emit,m=f({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,imageRatio:0,displayWidth:0,displayHeight:0}),p=v(),b=e((function(){var t=o.rootWidth,e=o.rootHeight/t;return m.imageRatio>e})),x=e((function(){var o=m.scale,t=m.moveX,e=m.moveY,a=m.moving,n={transitionDuration:m.zooming||a?"0s":".3s"};if(1!==o){var i=t/o,r=e/o;n.transform="scale("+o+", "+o+") translate("+i+"px, "+r+"px)"}return n})),I=e((function(){if(m.imageRatio){var t=o.rootWidth,e=o.rootHeight,a=b.value?e/m.imageRatio:t;return Math.max(0,(m.scale*a-t)/2)}return 0})),S=e((function(){if(m.imageRatio){var t=o.rootWidth,e=o.rootHeight,a=b.value?e:t*m.imageRatio;return Math.max(0,(m.scale*a-e)/2)}return 0})),P=function(t){(t=J(t,+o.minZoom,+o.maxZoom))!==m.scale&&(m.scale=t,d("scale",{scale:t,index:o.active}))},T=function(){P(1),m.moveX=0,m.moveY=0},_=function(o){var t=o.touches,e=p.offsetX;p.start(o),a=m.moveX,n=m.moveY,u=new Date,m.moving=1===t.length&&1!==m.scale,m.zooming=2===t.length&&!e.value,m.zooming&&(r=m.scale,s=io(o.touches))},C=function(o){var t=o.touches;if(p.move(o),(m.moving||m.zooming)&&w(o,!0),m.moving){var e=p.deltaX,i=p.deltaY,l=e.value+a,c=i.value+n;m.moveX=J(l,-I.value,I.value),m.moveY=J(c,-S.value,S.value)}if(m.zooming&&2===t.length){var u=io(t);P(r*u/s)}},N=function(){var o,t=p.offsetX,e=p.offsetY,a=new Date-u;t.value<10&&e.value<10&&a<250&&(c?(clearTimeout(c),c=null,o=m.scale>1?1:2,P(o),m.moveX=0,m.moveY=0):c=setTimeout((function(){d("close"),c=null}),250))},j=function(o){var t=!1;(m.moving||m.zooming)&&(t=!0,m.moving&&a===m.moveX&&n===m.moveY&&(t=!1),o.touches.length||(m.zooming&&(m.moveX=J(m.moveX,-I.value,I.value),m.moveY=J(m.moveY,-S.value,S.value),m.zooming=!1),m.moving=!1,a=0,n=0,r=1,m.scale<1&&T())),w(o,t),N(),p.reset()},z=function(o){var t=o.target,e=t.naturalWidth,a=t.naturalHeight;m.imageRatio=a/e};return i((function(){return o.active}),T),i((function(){return o.show}),(function(o){o||T()})),function(){var t,e,a={loading:function(){return l(y,{type:"spinner"},null)}};return l(F,{class:no("swipe-item"),onTouchstart:_,onTouchmove:C,onTouchend:j,onTouchcancel:j},"function"==typeof(e=t=l(to,{src:o.src,fit:"contain",class:no("image",{vertical:b.value}),style:x.value,onLoad:z},g({},a)))||"[object Object]"===Object.prototype.toString.call(e)&&!h(e)?t:{default:function(){return[t]}})}}};var so,lo=ao({props:{show:Boolean,className:null,closeable:Boolean,beforeClose:Function,showIndicators:Boolean,images:{type:Array,default:function(){return[]}},loop:{type:Boolean,default:!0},overlay:{type:Boolean,default:!0},minZoom:{type:[Number,String],default:1/3},maxZoom:{type:[Number,String],default:3},showIndex:{type:Boolean,default:!0},swipeDuration:{type:[Number,String],default:300},startPosition:{type:[Number,String],default:0},closeIcon:{type:String,default:"clear"},closeOnPopstate:{type:Boolean,default:!0},closeIconPosition:{type:String,default:"top-right"}},emits:["scale","close","closed","change","update:show"],setup:function(t,e){var a=e.emit,n=e.slots,r=o(),s=U(),c=f({active:0,rootWidth:0,rootHeight:0}),u=function(){if(r.value){var o=r.value.$el.getBoundingClientRect();c.rootWidth=o.width,c.rootHeight=o.height}},d=function(o){a("scale",o)},v=function(o){a("update:show",o)},g=function(){G({interceptor:t.beforeClose,args:[c.active],done:function(){v(!1)}})},w=function(o){o!==c.active&&(c.active=o,a("change",o))},y=function(){if(t.showIndex)return l("div",{class:no("index")},[n.index?n.index({index:c.active}):c.active+1+" / "+t.images.length])},P=function(){if(n.cover)return l("div",{class:no("cover")},[n.cover()])},T=function(){var o,e;return l(V,{ref:r,lazyRender:!0,loop:t.loop,class:no("swipe"),duration:t.swipeDuration,initialSwipe:t.startPosition,showIndicators:t.showIndicators,indicatorColor:"white",onChange:w},"function"==typeof(e=o=t.images.map((function(o){return l(ro,{src:o,show:t.show,active:c.active,maxZoom:t.maxZoom,minZoom:t.minZoom,rootWidth:c.rootWidth,rootHeight:c.rootHeight,onScale:d,onClose:g},null)})))||"[object Object]"===Object.prototype.toString.call(e)&&!h(e)?o:{default:function(){return[o]}})},_=function(){if(t.closeable)return l(p,{role:"button",name:t.closeIcon,class:no("close-icon",t.closeIconPosition),onClick:g},null)},C=function(){a("closed")},N=function(o,t){r.value&&r.value.swipeTo(o,t)};return b({swipeTo:N}),x(u),i([s.width,s.height],u),i((function(){return t.startPosition}),w),i((function(){return t.show}),(function(o){var e=t.images,n=t.startPosition;o?(w(+n),I((function(){u(),N(+n,{immediate:!0})}))):a("close",{index:c.active,url:e[c.active]})})),function(){return l(S,m({show:t.show,class:[no(),t.className],overlayClass:no("overlay"),closeOnPopstate:t.closeOnPopstate,onClosed:C},{"onUpdate:show":v}),{default:function(){return[_(),T(),y(),P()]}})}}}),co={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:null,onClose:null,onChange:null,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",beforeClose:null,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeIconPosition:"top-right"};var uo=function(o,t){if(void 0===t&&(t=0),r){var e;so||(e=A({setup:function(){var o=q(),t=o.state,e=o.toggle,a=function(){t.images=[]};return function(){return l(lo,g({},t,{onClosed:a,"onUpdate:show":e}),null)}}}),so=e.instance);var a=Array.isArray(o)?{images:o,startPosition:t}:o;return so.open(g({},co,a)),so}};uo.Component=lo,uo.install=function(o){o.use(lo)};var mo=P({name:"TopicInfo",props:{topic:{type:Object,default:{},required:!0}},methods:{getTabInfo:(o,t,e,a)=>T(o,t,e,a),getLastTimeStr:(o,t)=>_(o,t)}});const po=X("data-v-71559378");C("data-v-71559378");const fo={class:"d-flex align-items-center topic-info"},vo={key:0,class:"topic-info-avatar"},go={class:"flex-1"},ho={key:0},wo={class:"topic-info-wrap"},yo={class:"topic-info-name"};N();const bo=po(((o,t,e,a,n,i)=>{const r=d("lazy");return j(),z("section",fo,[o.topic.author?u((j(),z("img",vo,null,512)),[[r,o.topic.author.avatar_url]]):B("",!0),l("div",go,[o.topic.author?(j(),z("span",ho,L(o.topic.author.loginname),1)):B("",!0),l("time",null," 发布于："+L(o.getLastTimeStr(o.topic.create_at,!0)),1)]),l("div",wo,[l("span",{class:["topic-info-tag",o.getTabInfo(o.topic.tab,o.topic.good,o.topic.top,!0)],textContent:L(o.getTabInfo(o.topic.tab,o.topic.good,o.topic.top,!1))},null,10,["textContent"]),l("span",yo,L(o.topic.visit_count)+"次浏览",1)])])}));mo.render=bo,mo.__scopeId="data-v-71559378";var xo=P({name:"TopicPage",components:{[H.name]:H,NavHeader:R,TopicInfo:mo,TopicReply:Y((()=>k((()=>__import__("./topic-reply.aa8eea9e.js")),["/assets/topic-reply.aa8eea9e.js","/assets/topic-reply.3d12d5ac.css","/assets/index.f8c1ba6c.js","/assets/index.b7ca8b4b.css","/assets/index.403db992.js","/assets/mount-component.703d2a00.js","/assets/index.25550fa9.js","/assets/use-route.124dd958.js","/assets/useChildren.747839d4.js"]))),BackTop:Y((()=>k((()=>__import__("./back-top.07d8062c.js")),["/assets/back-top.07d8062c.js","/assets/back-top.d710be5d.css","/assets/index.f8c1ba6c.js","/assets/index.b7ca8b4b.css"])))},setup(){const o=O(),t=W(),a=e((()=>t.state.topic.topic));return Z((async()=>{var e;a.value.id||await t.dispatch(`topic/${E}`,null==(e=o.params)?void 0:e.id),I((()=>{const o=document.querySelectorAll(".markdown-body img"),t=[];o.forEach(((o,e)=>{let a=o.getAttribute("src");a.startsWith("http")||(a=`https:${a}`),t.push(a),o.addEventListener("click",(()=>{uo({images:t,startPosition:e,closeable:!0,teleport:"body"})}))}))}))})),{topic:a}}});const Io=X("data-v-71906ada");C("data-v-71906ada");const So={class:"topic-title"};N();const Po=Io(((o,t,e,a,n,i)=>{const r=D("nav-header"),s=D("topic-info"),c=D("van-skeleton"),u=D("topic-reply"),d=D("back-top");return j(),z($,null,[l(r,{title:"主题"}),l("h2",So,L(o.topic.title),1),l(c,{title:"",avatar:"",row:5,loading:!o.topic.id,class:"skeleton-top"},{default:Io((()=>[l(s,{topic:o.topic},null,8,["topic"]),l("section",{class:"markdown-body topic-content van-hairline--bottom",innerHTML:o.topic.content},null,8,["innerHTML"])])),_:1},8,["loading"]),(j(),z(M,null,{default:Io((()=>[l(u,{topic:o.topic},null,8,["topic"])])),fallback:Io((()=>[l(c,{title:"",row:5,class:"skeleton-top"})])),_:1})),l(d)],64)}));xo.render=Po,xo.__scopeId="data-v-71906ada";export default xo;
