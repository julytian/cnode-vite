import{d as e,b as t,u as a,r as s,aC as n,Z as o,p as l,c as i,e as r,o as p,f as c,g as d,h as u,O as y,a as m,E as v,aD as f,J as h,R as I,Q as R,F as b,ab as k,ax as g,w as x}from"./index.9908f708.js";import{T as w}from"./index.e95e5ab2.js";import{F as C}from"./index.56af7e66.js";import"./mount-component.ba59bc39.js";import"./use-route.6231ecff.js";import"./useChildren.aacc0827.js";var _=e({name:"AddReply",components:{[C.name]:C},props:{topic:{type:Object,default:{},required:!0},replyId:{type:String,default:""},replyTo:{type:String,default:""},show:{type:Boolean,default:!1}},emits:["hideItemReply","onReload"],setup(e,{emit:l}){const i=t(),r=a(),p=s(""),{topic:c,replyTo:d,replyId:u,show:y}=e,{token:m}=i.state.user.userInfo;d&&(p.value=`@${d}`);return{content:p,submit:async()=>{if(!p.value)return void w("回复内容不能为空");const e={topic_id:r.params.id,accesstoken:m,content:p.value};u&&(e.reply_id=u);try{(await n(e)).success&&i.dispatch(`topic/${o}`,{id:c.id,reload:!0,token:m}),p.value="",y&&l("hideItemReply")}catch(t){}}}}});const U=u("data-v-94d89b90");l("data-v-94d89b90");const j={class:"reply"},T={class:"van-hairline--surround"};i();const H=U(((e,t,a,s,n,o)=>{const l=r("van-field");return p(),c("section",j,[d("div",T,[d(l,{modelValue:e.content,"onUpdate:modelValue":t[1]||(t[1]=t=>e.content=t),rows:"8",type:"textarea",border:!1,placeholder:"回复支持Markdown语法,请注意标记代码"},null,8,["modelValue"])]),d("div",{class:"reply-btn",onClick:t[2]||(t[2]=(...t)=>e.submit&&e.submit(...t))},"确定")])}));_.render=H,_.__scopeId="data-v-94d89b90";var L=e({name:"TopicReply",props:{topic:{type:Object,default:{},required:!0}},components:{Reply:_},methods:{getLastTimeStr:(e,t)=>y(e,t)},setup(){const e=t(),n=m(),o=a(),l=s(""),i=v((()=>e.state.user.userInfo.token)),r=v((()=>e.state.user.userInfo.userId)),p=()=>{l.value=""};return{handleReplyUps:async e=>{if(!i.value)return w("你还没登录~~"),void n.push(`/login?redirect=${encodeURIComponent(o.path)}`);try{if("down"===(await f(i.value,e.id)).action){const t=e.ups.findIndex((e=>e===r.value));e.ups.splice(t,1)}else e.ups.push(r.value)}catch(t){w("点赞失败")}},isUps:e=>e.ups.findIndex((e=>e===r.value))>=0,userId:r,curReplyId:l,addReply:e=>{if(!i.value)return w("你还没登录~~"),void n.push(`/login?redirect=${encodeURIComponent(o.path)}`);e===l.value?p():l.value=e},hideItemReply:p,handleHtmlContent:e=>e.replace(/\/user\//,"#/user/")}}});const M=u("data-v-fc44e6dc");l("data-v-fc44e6dc");const S={key:0,class:"topic-reply van-hairline--bottom van-hairline--top"},$=g(" 回复 "),O={class:"reply-list"},V={class:"d-flex align-items-center reply-user van-hairline--top"},q={class:"reply-avatar"},F={class:"d-flex align-items-center flex-1"},z={class:"flex-1 reply-info-content"},A={class:"reply-ups"};i();const B=M(((e,t,a,s,n,o)=>{const l=r("reply"),i=h("lazy");return p(),c(b,null,[e.topic.reply_count>=0?(p(),c("h3",S,[d("strong",null,I(e.topic.reply_count),1),$])):R("v-if",!0),d("section",O,[(p(!0),c(b,null,k(e.topic.replies,(a=>(p(),c(b,{key:a.id},[d("div",V,[x(d("img",q,null,512),[[i,a.author.avatar_url]]),d("div",F,[d("div",z,I(a.author.loginname)+" 发布于："+I(e.getLastTimeStr(a.create_at,!0)),1),d("span",{class:["iconfont reply-icon",{uped:e.isUps(a)}],onClick:t=>e.handleReplyUps(a)},"",10,["onClick"]),d("span",A,I(a.ups.length),1),d("span",{class:"iconfont reply-icon",onClick:t=>e.addReply(a.id)},"",8,["onClick"])])]),d("div",{class:"markdown-body reply-content",innerHTML:e.handleHtmlContent(a.content)},null,8,["innerHTML"]),e.userId&&e.curReplyId===a.id?(p(),c(l,{key:0,topic:e.topic,"onUpdate:topic":t[1]||(t[1]=t=>e.topic=t),"reply-id":a.id,"reply-to":a.author.loginname,show:!!e.curReplyId,onHideItemReply:e.hideItemReply},null,8,["topic","reply-id","reply-to","show","onHideItemReply"])):R("v-if",!0)],64)))),128)),e.topic.id&&e.userId?(p(),c(l,{topic:e.topic,"onUpdate:topic":t[2]||(t[2]=t=>e.topic=t),key:Math.random()},null,8,["topic"])):R("v-if",!0)])],64)}));L.render=B,L.__scopeId="data-v-fc44e6dc";export default L;
